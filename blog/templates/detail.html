{% extends 'base.html' %}

{% block content %}
    {% load static %}
    <head>
        <title>{{ article.title }}</title>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
        <script type="text/javascript">
            function getCookie(name) {
                var cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    var cookies = document.cookie.split(';');
                    for (var i = 0; i < cookies.length; i++) {
                        var cookie = jQuery.trim(cookies[i]);
                        // Does this cookie string begin with the name we want?
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }

            function ajax_like(like) {
                // создаем AJAX-вызов
                $.ajax({
                    headers: {"X-CSRFToken": getCookie("csrftoken")},
                    url: "{{ article.get_absolute_url }}" + "like/",
                    type: 'POST',
                    data: {'like_or_dislike': like},
                    // если успешно, то
                    success: function (response) {
                        $("#count_like").text(response.count_like);
                        $("#count_dislike").text(response.count_dislike);
                        if (like) {
                            $("#bt-like").toggleClass("icon_pressed");
                            if ($("#bt-dislike").hasClass("icon_pressed")) {
                                $("#bt-dislike").toggleClass("icon_pressed");
                            }
                        } else {
                            $("#bt-dislike").toggleClass("icon_pressed");
                            if ($("#bt-like").hasClass("icon_pressed")) {
                                $("#bt-like").toggleClass("icon_pressed");
                            }
                        }
                    },
                    // если ошибка, то
                    error: function (response) {
                        // предупредим об ошибке
                        console.log(response.responseJSON.errors)
                    }
                });
                return false;
            }

            $(document).ready(function () {
                $("#bt-like").click(function () {
                    ajax_like(1)
                });
                $("#bt-dislike").click(function () {
                    ajax_like(-1)
                });
            });
        </script>
    </head>
    <div class="container pt-5">
        <div class="card rounded p-3 py-4">
            <div class="d-flex justify-content-start">
                <span class="badge badge--info mx-1">{{ article.author }}</span>
                <span class="badge badge--secondary mx-1">{{ article.date }}</span>
            </div>
            <h3 class="list-group-item-heading">
                <h4>{{ article.title }}</h4>
            </h3>

            <p class="text-break">
                {{ article.content|safe }}
                <br/>
            </p>
            <div class="btn-toolbar mb-3" role="toolbar" aria-label="Toolbar with button groups">
                <div class="btn-group">
                    <button id="bt-like"
                            class="btn shadow-none btn-success bg-success{% if user_like %} icon_pressed{% endif %}">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                            <g xmlns="http://www.w3.org/2000/svg" transform="matrix(-1 0 0 -1 1024 1024)">
                                <path d="M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4a66.1 66.1 0 0 0-26.5-5.4H273v428h.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM112 132v364c0 17.7 14.3 32 32 32h65V100h-65c-17.7 0-32 14.3-32 32z"/>
                            </g>
                        </svg>
                        <span id="count_like" class="badge">{{ count_like }}</span>
                    </button>


                    <button id="bt-dislike"
                            class="btn shadow-none btn-danger bg-danger{% if user_like == False %} icon_pressed{% endif %}">
                        <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                            <path d="M885.9 490.3c3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-28.3-9.3-55.5-26.1-77.7 3.6-12 5.4-24.4 5.4-37 0-51.6-30.7-98.1-78.3-118.4a66.1 66.1 0 0 0-26.5-5.4H273v428h.3l85.8 310.8C372.9 889 418.9 924 470.9 924c29.7 0 57.4-11.8 77.9-33.4 20.5-21.5 31-49.7 29.5-79.4l-6-122.9h239.9c12.1 0 23.9-3.2 34.3-9.3 40.4-23.5 65.5-66.1 65.5-111 0-28.3-9.3-55.5-26.1-77.7zM112 132v364c0 17.7 14.3 32 32 32h65V100h-65c-17.7 0-32 14.3-32 32z"/>
                        </svg>
                        <span id="count_dislike" class="badge">{{ count_dislike }}</span>
                    </button>
                </div>

            </div>
        </div>
    </div>
{% endblock content %}